# 推しと学ぶ中国語 - HSK1-3級完全対応版

## 🎯 概要

HSK1級〜3級に完全対応した中国語学習ゲームです。600語の豊富な語彙を通じて、基礎から初中級レベルまでの中国語をマスターできます。**正答率ベースの段階的な画像表示システム**、**復習機能**、**改善された音声機能**で、学習の成果を視覚的に楽しみながら効率的に学習できます。

## ✨ 主な機能

### 📚 HSK等級別学習システム
- **HSK1級**: 基礎語彙150語 - 中国語学習の第一歩
- **HSK2級**: 初級語彙150語 - 日常会話の基盤
- **HSK3級**: 初中級語彙300語 - 表現力の大幅向上

### 🎮 2つの学習モード
- **文字問題**: 中国語の文字を見て日本語を選択
- **音声問題**: 中国語の音声を聞いて日本語を選択

### 🎨 正答率に応じた画像表示システム
- **81%〜100%**: `images0` - クリアな画像で完璧な達成感
- **61%〜80%**: `images20` - 軽いモザイクで良い成績
- **41%〜60%**: `images50` - 中程度のモザイクで及第点
- **21%〜40%**: `images70` - 強いモザイクで要努力
- **0%〜20%**: `images100` - 最も強いモザイクで励まし

### 🎵 音効果システム
- **正解音**: 明るいピンポン音で達成感をアップ
- **不正解音**: ブー音で間違いを明確に認識

### 🔊 改善された音声機能
- **インテリジェント音声選択**: 中国語音声を優先的に選択
- **フォールバック機能**: 中国語音声が見つからない場合の代替手段
- **ピンイン読み上げ**: 音声再生エラー時のピンインフォールバック
- **スマートフォン最適化**: タッチデバイスでの音声品質向上
- **リアルタイム状態表示**: 音声再生の進行状況を視覚的に表示

### 📚 復習機能
- **自動復習登録**: 不正解問題が自動的に復習リストに追加
- **問題タイプ保持**: 文字問題は文字問題として、音声問題は音声問題として復習
- **localStorage保存**: ブラウザ再起動後も復習リストが保持
- **効率的学習**: 間違えた問題のみを集中的に復習

### 🏠 便利なナビゲーション
- **戻るボタン**: 各問題からホーム画面にすぐ戻れる
- **ペアレベル機能**: 文字問題↔音声問題の連携学習
- **進捗表示**: 現在の問題数と正解数を常時表示

### 🔧 デバッグ機能
- **音声問題診断**: 開発者向けの音声状態確認ツール
- **リアルタイム監視**: 音声再生の詳細情報を表示
- **コンソールコマンド**: ブラウザ開発者ツールからの直接操作

## 🗂️ ファイル構成

```
Chuugokugo_game_AI_3_Clean/
├── index.html                 # メインゲーム画面
├── style.css                  # スタイルシート（音声UI改善対応）
├── rules.js                   # ゲームルール設定（HSK1-3級）
├── engine.js                  # ゲームエンジン（音声機能改善・復習機能・正答率ベース画像表示対応）
├── audio_debug.js             # 音声デバッグユーティリティ
├── images_config.json         # 画像ファイル設定
├── assets/
│   └── words/
│       └── hsk_vocabulary.js  # HSK1-3級語彙データ（600語）
├── tools/
│   └── vocabulary_builder.py  # 語彙データ構築ツール
├── images0/                   # 81%以上正解時のクリア画像
├── images20/                  # 61-80%正解時の軽いモザイク画像
├── images50/                  # 41-60%正解時の中程度モザイク画像
├── images70/                  # 21-40%正解時の強いモザイク画像
├── images100/                 # 0-20%正解時の最も強いモザイク画像
├── README.md                  # このファイル
└── AUDIO_IMPROVEMENTS.md     # 音声機能改善詳細ドキュメント
```

## 🎯 HSK等級別構成

| 等級 | ゲームレベル | 語彙数 | 学習内容 | 状況 |
|------|-------------|--------|----------|------|
| HSK1級 | レベル1-2 | 150語 | ✅ 完了 | 基礎の基礎語彙 |
| HSK2級 | レベル3-4 | 150語 | ✅ 完了 | 初級語彙 |
| HSK3級 | レベル5-6 | 300語 | ✅ 完了 | 初中級語彙 |

**総語彙数**: 600語（HSK1-3級完全対応）

## 🎨 画像表示システム詳細

### 正答率に応じた段階的表示
ゲーム終了時に、正答率に応じて異なるモザイクレベルの画像が表示されます：

| 正答率 | 画像フォルダ | モザイクレベル | メッセージ |
|--------|-------------|---------------|-----------|
| 81%〜100% | `images0` | なし（クリア） | 「太棒了！完璧です！」 |
| 61%〜80% | `images20` | 軽い | ランダムな褒め言葉 |
| 41%〜60% | `images50` | 中程度 | 「不错！よくできました！」 |
| 21%〜40% | `images70` | 強い | 「不错！よくできました！」 |
| 0%〜20% | `images100` | 最も強い | 「加油！頑張って！」 |

### 画像ファイル命名規則
各フォルダには以下の命名規則で画像が配置されています：
- `01.png` 〜 `05.png`（images0フォルダ）
- `01_mosaic_20.png` 〜 `05_mosaic_20.png`（images20フォルダ）
- `01_mosaic_50.png` 〜 `05_mosaic_50.png`（images50フォルダ）
- `01_mosaic_70.png` 〜 `05_mosaic_70.png`（images70フォルダ）
- `01_mosaic_100.png` 〜 `05_mosaic_100.png`（images100フォルダ）

## 🔊 音声機能詳細

### インテリジェント音声選択
- **中国語音声優先**: `zh-CN`、`cmn`、中国語関連の音声を自動検出
- **フォールバック機能**: 中国語音声が見つからない場合の代替手段
- **音声品質最適化**: 速度0.7、音調1.0、音量1.0で聞き取りやすく調整

### ピンインフォールバック
- **自動切り替え**: 中国語音声再生エラー時に自動的にピンイン読み上げ
- **英語読み上げ**: ピンインを英語として読み上げ（発音が近い）
- **速度調整**: 0.6の速度でより聞き取りやすく

### スマートフォン最適化
- **タッチデバイス検出**: 自動的に音声設定を最適化
- **音声状態表示**: リアルタイムで音声再生の進行状況を表示
- **ボタン状態管理**: 再生中のボタン無効化と視覚的フィードバック

### 音声再生状態表示
- **準備中...**: 音声問題開始時の初期状態
- **再生中... 🔊**: 音声再生中の状態
- **再生完了**: 音声再生完了時の状態
- **エラー - ピンインで再生**: エラー時のフォールバック状態

## 📚 復習機能詳細

### 自動復習登録
- **不正解時自動追加**: 間違えた問題が即座に復習リストに登録
- **重複防止**: 同じ問題は一度だけ登録
- **メタデータ保存**: レベル・問題タイプ・選択肢を完全保存

### 復習問題の表示
- **問題タイプ保持**: 文字問題は文字問題として、音声問題は音声問題として復習
- **選択肢復元**: 元の問題と同じ選択肢で出題
- **正解判定**: 通常の問題と同様の判定・フィードバック

### 復習セッション管理
- **チェックボックス選択**: 復習したい問題を選択
- **全選択/全解除**: 効率的な問題選択
- **即座削除**: 覚えた問題はチェックを外すだけで削除
- **復習再開**: 同じ復習セットを何度でも再開可能

## 🔧 デバッグ機能詳細

### デバッグモードの有効化
URLに `?debug=audio` を追加することで音声デバッグ機能が有効になります：
```
https://your-domain.com/?debug=audio
```

### 開発者コンソールコマンド
```javascript
// 音声合成の状態をチェック
checkAudio();

// テスト音声を再生
testAudio('你好');

// カスタムテキストでテスト
testAudio('会');
```

### デバッグパネル
- **右上表示**: 音声情報をリアルタイムで表示
- **自動非表示**: 5秒後に自動的に非表示
- **詳細情報**: 文字、ピンイン、音声言語、音声名、状態、エラーを表示

## 🚀 使い方

### 基本的な学習フロー
1. **ホーム画面**でレベルを選択
2. **5問連続**で語彙問題に挑戦
3. **音効果**で正解・不正解を確認
4. **音声問題**では中国語の音声を聞いて日本語を選択
5. **結果画面**で正答率に応じた画像とメッセージを確認
6. **復習ボタン**で間違えた問題を復習
7. **戻るボタン**でいつでもホームに戻れる

### 推奨学習順序
1. **HSK1級文字問題** → **HSK1級音声問題**
2. **HSK2級文字問題** → **HSK2級音声問題**  
3. **HSK3級文字問題** → **HSK3級音声問題**
4. **復習機能**で間違えた問題を集中的に学習

### ペアレベル機能
各レベル完了後、「ペアレベル」ボタンで対応する問題形式に自動移動：
- レベル1（HSK1級文字）→ レベル2（HSK1級音声）
- レベル3（HSK2級文字）→ レベル4（HSK2級音声）
- レベル5（HSK3級文字）→ レベル6（HSK3級音声）

### 復習機能の活用
1. **復習ボタン**で復習リストを表示
2. **チェックボックス**で復習したい問題を選択
3. **復習開始**で選択した問題に挑戦
4. **覚えた問題**はチェックを外して削除
5. **復習完了後**は「復習を再開」で同じセットを再学習

### 音声問題の活用
1. **自動再生**: 音声問題開始後0.8秒で自動再生
2. **手動再生**: 「🔊 もう一度聞く」ボタンで再再生
3. **状態確認**: 音声再生の進行状況をリアルタイムで確認
4. **フォールバック**: エラー時は自動的にピンイン読み上げ

## 💡 機能詳細

### 🎨 正答率ベース画像表示システム
- **5段階のモザイクレベル**で学習成果を視覚化
- **正答率による公平な評価**で復習問題にも対応
- **ランダム画像選択**で毎回異なる報酬画像
- **前回表示画像の除外**で多様性を確保

### 🎵 音効果システム
- **Web Audio API**を使用した高品質な音効果
- **正解**: 800Hz→1000Hzの明るいピンポン音
- **不正解**: 200Hzのサウトゥース波による低音ブー

### 🔍 改善された音声問題での学習効果
- **インテリジェント音声選択**: 中国語音声を優先的に選択
- **フォールバック機能**: 中国語音声が見つからない場合の代替手段
- **ピンイン読み上げ**: 音声再生エラー時のピンインフォールバック
- **スマートフォン最適化**: タッチデバイスでの音声品質向上
- **リアルタイム状態表示**: 音声再生の進行状況を視覚的に表示

### 📚 復習機能の学習効果
- **間違いの自動記録**: 学習者が意識せずに復習リストが構築
- **問題タイプの保持**: 文字・音声両方の学習効果を最大化
- **効率的な復習**: 間違えた問題のみを集中的に学習
- **継続的な学習**: 覚えるまで何度でも復習可能

### 🏠 戻るボタン機能
- ゲーム画面上部の「← ホームに戻る」ボタン
- ワンクリックでスタート画面に戻れる
- 学習の自由度が大幅向上

## 📊 学習効果

### HSK1-3級完全対応の意義
- **HSK1級**: 中国語の基礎固め（150語）
- **HSK2級**: 日常会話の土台作り（150語）
- **HSK3級**: 表現力の飛躍的向上（300語）

### 正答率ベース評価システムの効果
- **段階的な達成感**でモチベーション維持
- **公平な評価基準**で復習問題にも対応
- **視覚的フィードバック**で学習成果を実感
- **適切な励まし**で継続学習を促進

### 改善された音声機能による学習効果
- **正確な中国語発音**: インテリジェント音声選択で品質向上
- **フォールバック機能**: 音声問題の安定性向上
- **スマートフォン対応**: モバイルデバイスでの学習体験向上
- **リアルタイムフィードバック**: 音声状態の可視化

### 復習機能による学習効果
- **効率的な学習**: 間違えた問題のみを集中的に復習
- **記憶の定着**: 覚えるまで繰り返し学習
- **学習進捗の可視化**: 復習リストで学習状況を把握
- **継続的な成長**: 段階的なレベルアップ

### 合計600語による学習効果
- **基礎から初中級**まで体系的学習
- **HSK試験対策**として実用的
- **段階的レベルアップ**で確実な成長

## 🎨 UI/UX改善

### 視覚的改善
- **グラデーション背景**による美しいデザイン
- **レスポンシブ対応**でデバイス問わず快適
- **段階的モザイク画像**でゲーム感覚を強化
- **音声プレイヤー**: 背景色とボーダーの追加、グラデーション背景のボタン

### 操作性向上
- **戻るボタン**でナビゲーション自由度アップ
- **音効果**で操作フィードバック明確化
- **復習機能**で効率的な学習をサポート
- **改善された音声機能**で音声問題の学習効果最大化
- **音声再生ボタン**: クリック時の一時無効化、再生中の視覚的フィードバック

### 音声問題のUI改善
- **音声プレイヤー**: 背景色とボーダーの追加
- **状態表示**: 音声再生状態のリアルタイム更新
- **ボタン改善**: ホバー効果の最適化、タッチデバイスでの使いやすさ向上
- **スマートフォン対応**: レスポンシブデザインの強化

## 🔧 技術仕様

### フロントエンド
- **HTML5/CSS3/JavaScript (ES6+)**
- **Web Audio API** (音効果)
- **Web Speech Synthesis API** (改善された中国語音声合成)

### 語彙データ
- **JavaScript配列形式**で600語を管理
- **品詞分類**: 名詞、動詞、形容詞、副詞、助詞など
- **HSK等級別構造**で段階的学習をサポート

### 画像システム
- **正答率ベース判定**: 5段階のモザイクレベル
- **公平な評価**: 問題数に関係なく正答率で判定
- **ランダム選択**: 各フォルダ内の画像をランダム表示
- **重複回避**: 前回表示画像を除外して多様性を確保

### 改善された音声技術
- **インテリジェント音声選択**: 中国語音声の優先選択とフォールバック
- **ピンイン読み上げ**: 音声再生エラー時の英語読み上げフォールバック
- **スマートフォン最適化**: タッチデバイスの自動検出と音声設定最適化
- **リアルタイム状態表示**: 音声再生の進行状況を視覚的に表示
- **音声品質最適化**: 速度0.7、音調1.0、音量1.0で聞き取りやすく調整

### 復習システム
- **ReviewStoreクラス**: 復習データの管理・永続化
- **localStorage対応**: ブラウザ再起動後もデータ保持
- **問題タイプ保持**: 文字・音声問題の正確な復元
- **選択肢復元**: 元の問題と同じ選択肢で出題

### デバッグシステム
- **AudioDebuggerクラス**: 音声問題の診断と監視
- **デバッグパネル**: リアルタイムの音声状態表示
- **コンソールコマンド**: 開発者向けの音声テスト機能
- **エラーハンドリング**: 音声再生エラーの詳細情報表示

### 開発ツール
- **vocabulary_builder.py**: 語彙データの構築・管理ツール
- **images_config.json**: 画像ファイルの設定管理
- **audio_debug.js**: 音声機能のデバッグと診断

## 📝 今後の可能性

### 学習機能拡張
- 学習履歴・統計機能
- 時間制限モード
- 難易度調整機能

### 画像システム拡張
- より多くの画像バリエーション
- アニメーション効果
- カスタム画像アップロード機能

### 音声機能拡張
- 音声キャッシュ機能
- より自然な中国語発音
- 音調調整機能
- ユーザー設定による音声カスタマイズ

### データ拡張
- 例文追加による文脈学習
- 語彙の関連語表示
- より詳細な品詞分類

### 復習機能拡張
- 復習スケジュール機能
- 復習効果の測定
- 個別問題の難易度評価

### デバッグ機能拡張
- より詳細な音声分析
- パフォーマンス監視
- ユーザー向けの診断ツール

## ⚠️ 注意事項

- **音声機能**にはブラウザの音声再生許可が必要
- **Chrome/Safari等のモダンブラウザ**推奨
- **スマートフォン対応**済み（音声機能も最適化）
- **画像ファイル**は各フォルダに適切に配置してください
- **localStorage**を使用するため、プライベートブラウジングモードでは復習データが保存されません
- **音声問題**では、デバイスによって音声品質が異なる場合があります

## 🛠️ 開発・カスタマイズ

### 語彙データの追加・編集
`tools/vocabulary_builder.py`を使用して語彙データを管理できます。

### 画像の追加・変更
各`images*`フォルダに画像ファイルを配置し、`images_config.json`で設定を管理します。

### 音声設定の調整
`engine.js`の`playChineseAudio()`関数で音声合成の設定を調整できます。

### 音声デバッグの活用
`audio_debug.js`を使用して音声問題の診断と監視ができます。

### 復習機能のカスタマイズ
`engine.js`の`ReviewStore`クラスで復習データの管理方法を調整できます。

## 🔍 トラブルシューティング

### 音声が再生されない
1. ブラウザの音声設定を確認
2. デバッグモード（`?debug=audio`）で音声状態をチェック
3. コンソールでエラーメッセージを確認
4. `checkAudio()`コマンドで音声合成の状態を確認

### 日本語読みが発生する
1. デバッグモードで中国語音声の利用可能性を確認
2. フォールバック機能が動作しているか確認
3. `testAudio('会')`でテスト音声を再生
4. 音声設定のリセット

### 音質が悪い
1. 音声速度の調整（`engine.js`の`utterance.rate`）
2. 異なる音声エンジンの選択
3. ブラウザの更新
4. デバッグモードで音声詳細を確認

---

**🎉 HSK1-3級の600語で中国語の基礎を完全マスター！**

推しキャラと一緒に楽しく中国語を学習し、**改善された音声機能**、正答率に応じた段階的な達成感、復習機能で効率的に学習しながら、HSK試験合格を目指しましょう！

**🔊 音声機能の詳細は `AUDIO_IMPROVEMENTS.md` をご確認ください。** 